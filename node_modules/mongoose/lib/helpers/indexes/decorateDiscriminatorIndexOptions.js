'use strict';

module.exports = function decorateDiscriminatorIndexOptions(schema, indexOptions) {
  // If the model is a discriminator and has an index, add a
  // partialFilterExpression by default so the index will only apply
  // to that discriminator.
<<<<<<< HEAD
  const discriminatorName = schema.discriminatorMapping && schema.discriminatorMapping.value;
=======
  const discriminatorName = schema.discriminatorMapping?.value;
>>>>>>> 51e1f831f5ec4fb695d9c9fad5e573005cd428c5
  if (discriminatorName && !('sparse' in indexOptions)) {
    const discriminatorKey = schema.options.discriminatorKey;
    indexOptions.partialFilterExpression = indexOptions.partialFilterExpression || {};
    indexOptions.partialFilterExpression[discriminatorKey] = discriminatorName;
  }
  return indexOptions;
};
